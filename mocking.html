<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mocking Services - Local Web Services</title>
  <meta name="description" content="Mock AWS service operations and external API dependencies. Override AWS responses at the operation level, or create mock HTTP/GraphQL/gRPC servers for third-party APIs.">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <nav class="nav">
    <div class="container nav-inner">
      <a href="index.html" class="nav-logo">Local Web Services</a>
      <ul class="nav-links">
        <li><a href="getting-started.html">Get Started</a></li>
        <li><a href="services.html">Cloud Emulation</a></li>
        <li><a href="mocking.html" class="nav-active">Mocking Services</a></li>
        <li><a href="chaos.html">Chaos Engineering</a></li>
        <li><a href="cli.html">CLI</a></li>
        <li><a href="https://github.com/local-web-services/local-web-services" class="nav-github">GitHub</a></li>
      </ul>
    </div>
  </nav>

  <header class="page-header">
    <div class="container">
      <h1>Mocking Services</h1>
      <p class="section-lead">Override AWS service responses at the operation level, or create mock servers for external API dependencies. Control exactly what your application sees &mdash; without changing your code.</p>
    </div>
  </header>

  <!-- ============================================ -->
  <!-- AWS SERVICE MOCKING                          -->
  <!-- ============================================ -->

  <section class="section section-alt">
    <div class="container">
      <h2>AWS Service Mocking</h2>
      <p class="section-lead">Override individual AWS API operations with custom responses. Mocked operations bypass the real emulation entirely &mdash; your code gets back exactly what you define.</p>

      <div class="feature-grid" style="grid-template-columns: 1fr 1fr; max-width: 900px; margin: 0 auto;">
        <div class="feature-card">
          <div class="feature-icon">&#9881;</div>
          <h3>Operation-Level Control</h3>
          <p>Mock specific operations like <code>GetItem</code> or <code>ReceiveMessage</code> while leaving the rest of the service running normally.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#9889;</div>
          <h3>Service-Aware Helpers</h3>
          <p>Built-in helpers auto-format responses for each service &mdash; DynamoDB JSON, S3 XML, SQS message structures &mdash; so you don't have to.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h3 class="section-subheading section-subheading--large" style="margin-top: 0;">How AWS Mocking Works</h3>
      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Create a Mock</h3>
            <p>Create a named mock targeting a specific AWS service.</p>
            <div class="code-block"><code>uvx --from local-web-services lws aws-mock create my-s3-mock --service s3</code></div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>Add Operation Rules</h3>
            <p>Define what specific operations should return. Use service-aware helpers for correctly formatted responses.</p>
            <div class="code-block"><code># Mock a DynamoDB GetItem with a helper
uvx --from local-web-services lws aws-mock add-operation my-ddb-mock \
  --operation get-item \
  --item '{"id": "123", "name": "test"}'

# Mock an S3 GetObject with string content
uvx --from local-web-services lws aws-mock add-operation my-s3-mock \
  --operation get-object \
  --body-string "Hello from S3"

# Mock with a raw response
uvx --from local-web-services lws aws-mock add-operation my-mock \
  --operation list-objects-v2 \
  --status 200 \
  --body-file /path/to/response.xml</code></div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h3>Requests Are Intercepted</h3>
            <p>When your code calls a mocked operation, the mock middleware intercepts the request before it reaches the real provider and returns your custom response.</p>
          </div>
        </div>
      </div>

      <h3 class="section-subheading">Supported Services</h3>
      <div class="service-index">
        <span class="op">DynamoDB</span>
        <span class="op">SQS</span>
        <span class="op">S3</span>
        <span class="op">SNS</span>
        <span class="op">EventBridge</span>
        <span class="op">Step Functions</span>
        <span class="op">Cognito</span>
        <span class="op">SSM</span>
        <span class="op">Secrets Manager</span>
        <span class="op">IAM</span>
      </div>

      <h3 class="section-subheading">Service-Aware Helpers</h3>
      <p class="section-lead">Helpers automatically format responses in the correct service-specific format.</p>

      <div class="services-list">
        <div class="service-detail">
          <div class="service-detail-header">
            <h3>DynamoDB</h3>
          </div>
          <div class="service-detail-section">
            <h4>Helper Options</h4>
            <div class="service-detail-ops">
              <span class="op">--item</span>
              <span class="op">get-item</span>
              <span class="op">query</span>
              <span class="op">scan</span>
            </div>
          </div>
          <p class="service-note">Converts simple JSON to DynamoDB JSON format with type descriptors automatically. <code>--item '{"id": "123", "age": 30}'</code> becomes <code>{"id": {"S": "123"}, "age": {"N": "30"}}</code>.</p>
        </div>

        <div class="service-detail">
          <div class="service-detail-header">
            <h3>S3</h3>
          </div>
          <div class="service-detail-section">
            <h4>Helper Options</h4>
            <div class="service-detail-ops">
              <span class="op">--body-string</span>
              <span class="op">--body-file</span>
              <span class="op">get-object</span>
              <span class="op">list-objects-v2</span>
              <span class="op">head-object</span>
            </div>
          </div>
          <p class="service-note">Returns file content with proper headers (Content-Type, Content-Length, ETag). List operations generate correct S3 XML listings.</p>
        </div>

        <div class="service-detail">
          <div class="service-detail-header">
            <h3>SQS, SSM, Secrets Manager, Cognito, SNS, Step Functions, EventBridge</h3>
          </div>
          <p class="service-note">Each service has helpers that format responses in the correct structure: SQS XML messages with auto-generated IDs, SSM parameter metadata, Cognito JWT tokens, SNS message IDs, Step Functions execution ARNs, and EventBridge entry responses.</p>
        </div>
      </div>

      <h3 class="section-subheading">Conditional Matching</h3>
      <p class="section-lead">Match requests by headers to return different responses for different inputs.</p>
      <div class="config-example">
        <div class="code-block"><code>uvx --from local-web-services lws aws-mock add-operation my-s3-mock \
  --operation get-object \
  --match-header "x-custom-header=specific-value" \
  --status 200 \
  --body-string "Custom response for matched header"</code></div>
      </div>

      <h3 class="section-subheading">YAML Configuration</h3>
      <p class="section-lead">AWS mocks are stored in <code>.lws/mocks/&lt;name&gt;/</code> and loaded automatically on startup.</p>
      <div class="config-example">
        <div class="code-block"><code># .lws/mocks/my-s3-mock/config.yaml
name: my-s3-mock
service: s3
enabled: true</code></div>
      </div>
      <div class="config-example">
        <div class="code-block"><code># .lws/mocks/my-s3-mock/operations/get-object.yaml
operations:
  - operation: get-object
    match:
      headers:
        x-custom-header: "specific-value"
    response:
      status: 200
      body: "file content"
      content_type: "text/plain"
      delay_ms: 100</code></div>
      </div>

      <h3 class="section-subheading">Runtime Control</h3>
      <p class="section-lead">Enable and disable AWS mocks at runtime without restarting <code>ldk dev</code>.</p>
      <div class="config-example">
        <div class="code-block"><code># Enable/disable mocks for a service
uvx --from local-web-services lws aws-mock enable s3
uvx --from local-web-services lws aws-mock disable s3

# Check mock status
uvx --from local-web-services lws aws-mock status</code></div>
      </div>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- EXTERNAL SERVICE MOCKING                     -->
  <!-- ============================================ -->

  <section class="section section-alt">
    <div class="container">
      <h2>External Service Mocking</h2>
      <p class="section-lead">Create local mock servers for external API dependencies &mdash; payment processors, third-party services, partner APIs &mdash; so your entire application runs locally without any external calls.</p>

      <div class="feature-grid" style="grid-template-columns: 1fr 1fr; max-width: 900px; margin: 0 auto;">
        <div class="feature-card">
          <div class="feature-icon">$0</div>
          <h3>No API Costs</h3>
          <p>Stop burning through sandbox credits and rate limits during development. Mock servers return realistic responses without making real API calls.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&empty;</div>
          <h3>No Credentials Needed</h3>
          <p>New developers don't need API keys for every third-party service. Mock servers work out of the box with zero configuration.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h3 class="section-subheading section-subheading--large" style="margin-top: 0;">How External Mocking Works</h3>

      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Create a Mock Server</h3>
            <p>Define a mock server for each external dependency. Give it a name and optional base configuration.</p>
            <div class="code-block"><code>uvx --from local-web-services lws mock create --name stripe-api</code></div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>Add Routes</h3>
            <p>Define the endpoints your code calls, with the responses you want returned. Use CLI commands or YAML configuration.</p>
            <div class="code-block"><code>uvx --from local-web-services lws mock add-route \
  --name stripe-api \
  --method POST --path /v1/charges \
  --status 200 \
  --body '{"id": "ch_{{uuid}}", "status": "succeeded"}'</code></div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h3>Start with ldk dev</h3>
            <p>Mock servers start automatically alongside your AWS services when you run <code>ldk dev</code>. Each mock gets its own local endpoint.</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h3>Point Your Code</h3>
            <p>Configure your application to use the local mock endpoint instead of the real API. Environment variables are injected automatically for services defined in your IaC.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section section-alt">
    <div class="container">
      <h2>Protocol Support</h2>
      <p class="section-lead">Mock servers support the protocols your external dependencies use.</p>

      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">REST</div>
          <h3>REST / HTTP</h3>
          <p>Full HTTP method support (GET, POST, PUT, PATCH, DELETE). Match requests by path, headers, query parameters, and body fields. Return custom status codes, headers, and JSON/text bodies.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">GQL</div>
          <h3>GraphQL</h3>
          <p>Match GraphQL queries and mutations by operation name. Return typed response data with support for variables, nested objects, and error responses.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">gRPC</div>
          <h3>gRPC</h3>
          <p>Define service methods and return protobuf-compatible JSON responses. Supports unary calls with status codes and metadata.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2>Defining Routes</h2>
      <p class="section-lead">Routes define how your mock server responds to incoming requests. Configure them via CLI or YAML.</p>

      <h3 class="section-subheading">Basic Route</h3>
      <div class="config-example">
        <div class="code-block"><code>routes:
  - method: POST
    path: /v1/charges
    status: 200
    headers:
      Content-Type: application/json
    body: |
      {
        "id": "ch_{{uuid}}",
        "amount": {{body.amount}},
        "currency": "{{body.currency}}",
        "status": "succeeded",
        "created": {{timestamp}}
      }</code></div>
      </div>

      <h3 class="section-subheading">Conditional Matching</h3>
      <p class="section-lead">Routes can match on headers, query parameters, and body fields to return different responses for different inputs.</p>
      <div class="config-example">
        <div class="code-block"><code>routes:
  # Match by header
  - method: GET
    path: /v1/customers
    match:
      headers:
        Authorization: "Bearer sk_test_valid"
    status: 200
    body: '{"data": [{"id": "cus_123"}]}'

  # Match by query parameter
  - method: GET
    path: /v1/customers
    match:
      query:
        email: "not-found@example.com"
    status: 200
    body: '{"data": []}'

  # Match by body field
  - method: POST
    path: /v1/charges
    match:
      body:
        amount: 99999
    status: 402
    body: '{"error": {"type": "card_error", "message": "Card declined"}}'</code></div>
      </div>
    </div>
  </section>

  <section class="section section-alt">
    <div class="container">
      <h2>Template Variables</h2>
      <p class="section-lead">Use template variables in response bodies to generate dynamic, realistic responses.</p>

      <div class="services-list">
        <div class="service-detail">
          <div class="service-detail-header">
            <h3>Available Variables</h3>
          </div>
          <div class="service-detail-section">
            <h4>Built-in Generators</h4>
            <div class="service-detail-ops">
              <span class="op">{{uuid}}</span>
              <span class="op">{{timestamp}}</span>
              <span class="op">{{random_int(min,max)}}</span>
              <span class="op">{{random_choice(a,b,c)}}</span>
            </div>
          </div>
          <div class="service-detail-section">
            <h4>Request Data</h4>
            <div class="service-detail-ops">
              <span class="op">{{path.paramName}}</span>
              <span class="op">{{query.paramName}}</span>
              <span class="op">{{header.name}}</span>
              <span class="op">{{body.field}}</span>
            </div>
          </div>
        </div>
      </div>

      <h3 class="section-subheading">Example</h3>
      <div class="config-example">
        <div class="code-block"><code>routes:
  - method: POST
    path: /v1/payments
    status: 200
    body: |
      {
        "id": "pay_{{uuid}}",
        "amount": {{body.amount}},
        "currency": "{{body.currency}}",
        "status": "{{random_choice(succeeded,pending,requires_action)}}",
        "created": {{timestamp}},
        "receipt_number": {{random_int(1000,9999)}}
      }</code></div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2>OpenAPI Import</h2>
      <p class="section-lead">Automatically generate mock routes from existing OpenAPI 3.x or Swagger 2.x specifications.</p>

      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Import a Spec</h3>
            <p>Point <code>lws mock import-spec</code> at an OpenAPI file. Routes are generated for every endpoint with example responses from the spec.</p>
            <div class="code-block"><code>uvx --from local-web-services lws mock import-spec \
  --name stripe-api \
  --spec openapi.yaml</code></div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>Validate Coverage</h3>
            <p>Check that your mock covers all the endpoints your code actually calls. The validate command compares your mock routes against the spec and reports missing coverage.</p>
            <div class="code-block"><code>uvx --from local-web-services lws mock validate \
  --name stripe-api \
  --spec openapi.yaml</code></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-inner">
        <div class="footer-brand">
          <a href="index.html" class="nav-logo">Local Web Services</a>
          <p>The fastest feedback loop for cloud-native development, for humans and AI alike</p>
        </div>
        <div class="footer-links">
          <a href="https://github.com/local-web-services/local-web-services">GitHub</a>
          <a href="https://github.com/local-web-services/sample-project">CDK Sample</a>
          <a href="https://github.com/local-web-services/sample-project-terraform">Terraform Sample</a>
          <a href="https://github.com/local-web-services/local-web-services/issues">Issues</a>
        </div>
      </div>
      <p class="footer-copy">Open source under the MIT License.</p>
    </div>
  </footer>

</body>
</html>
